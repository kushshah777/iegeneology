<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<meta name="name" content="Concept Map" />
	<meta name="description" content="An abstract mapping for parameters. Works best if first tag is 'unique' among the tracklist, and the second tag applies to multiple tracks"/>
	<meta name="mintags" content="2" />
	<meta name="maxtags" content="2" />
	<title>Jam Cellar 2014-05-06</title>

<style>

svg {
    font: 12px sans-serif;
}

text {
    pointer-events: none;
    color: yellow;
}

.inner_node rect {
    pointer-events: all;
}

.inner_node rect.highlight {
    stroke: #315B7E;
    stroke-width: 2px;
}

.outer_node circle {
    fill: #1ff;
    stroke: steelblue;
    stroke-width: 1.5px;
    pointer-events: all;
}

.outer_node circle.highlight
{
    stroke: #315B7E;
    stroke-width: 2px;
}

.link {
    fill: none;
}
.links line {
  stroke: #999;
  stroke-opacity: 0.6;
}

.nodes circle {
  align-self: center;
  stroke: blue ;
  stroke-width: 0px;
  transform: translate(500px, 500px);
  text-align: center;
  background: #000
}
}

</style>	
</head>
<body>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script>
//
// Generated by the Exaile Playlist Analyzer plugin.
// (C) 2014 Dustin Spicuzza <dustin@virtualroadside.com>
//
// This work is licensed under the Creative Commons Attribution 4.0
// International License. To view a copy of this license, visit
// http://creativecommons.org/licenses/by/4.0/.
//
// Inspired by http://www.findtheconversation.com/concept-map/
// Loosely based on http://bl.ocks.org/mbostock/4063550
//


var data = [["Adedeji B. Badiru",["Omitaomu, Olufemi A.", "Hudson, Carl Randy", "Jones,Wayne",  "Bridges,Tim","Milatovic,Milan","Sieger,David","Rogers,Steve","Pamela McCauley","Peters,John","Chukwu,Nathaniel"]], ["Richard Biehl"], ["Vladimir Boginski",["Grigory Pastukhov","Oleg Shirokikh" ,"Alexey Sorokin",    "Vladimir Stozhkov",    "Alexander Veremyev",   "Cheng-Lung","Mengnan Chen","Guanxiang Yun"]] 
,["Christina Bouwens"]
,["Mark Calabrese"]
,["Ahmad Elshennawy",["Murad Andejany", "Mohammed Alomairy",    "Julie Sisson", "Shawn Michael Gallaher",   "Diala Gammoh", "Joseph Bass","Mohammed Alghamdi","Andreas Kuncoro","Haitham Ahmed Bahaitham","Abdullah Halawany","Melissa Francisco","Abdulrahman Albar","Hemaid Alsulami",    "Somesh Ghunakikar","Chintanai Praisont","Zec Gorana Knezevic","Sompoap Talabgaew","Hani Mohammad Aburas","Â Sandra L. Furterer","Mohammad Mesaad Al-Asiri"]]
,["John V. Farr"]
,["Ivan Garibay",["Chathika Gunaratne", "Chathurani Senevirathna",  "Milad Talebzadehhosseini", "Mostafa Saeidi","Nisha Baral","Prateek Basavaraj","Brett Belcher","Yunus Emre Gene","Ramya Akula"]]
,["Robert Hoekstra",["Todd M. Dvorak","Eric Sola"]]
,["Waldemar Karwowski",["Asli Soyler Akbas","Alex Rummel","Barclay Brown","Mitchell Rabinowitz","Wilfred Henry Wells","Afrifah Bobbie","Anastasia Angelopoulou","Henry Glaspie","Omar Alrehaili","Nelson Lerma","Monica Philippart","Behzad Esmaeilian","Hong Jiang","Ashraf Alhujailli","Konstantinos Mykoniatis","Anthony Costello","Mohammad Alsowayigh","M Pettitt","Halil Bozkurt","Muyuan Li","Muhanna Alnoaimi","Chris Andrzejczak","Yiling He","Andrew Xenos Richardson","Erman Cakit","Thomas Bergmann","Awad M. Aljuaid","Kevin Muhs","Henriette Shoen","Xu, Ziping","Joseph Garmon","Denton Gibson","Raul Fernandez-Sumano","Mahjabeen Rahman","Farzad Vasheghani-Farahani","Nina Ismail","Ledlyne Vasquez","Sara Hejazi","Mohammad Reza Davahli","Bohdana Sherehiy","Tamer Khaled","Tanapun Karunanont","John Layer","David Rodrick","Veronica H. Smith","John Dzissah","Renliu Jang","Bradley Chase","Jussi Kantola","WookGee Lee"]]
,["Heather Keathley"]
,["Timothy Kotnour",["Catherine Vergopia","Brig J. Bjorn","Eric Tucker","Serina Al-Haddad","Rey Diaz","Robert Beaver","Feo Rafael Ernesto Landaeta","Jose Luis Nunez","Alper Camci"]]
,["Gene Lee",["Peter McAlindon","Young Yoo","Jae W. Lee","John P. Holmquist","Kyongsun Lee","Mario Marin","John Pastrana","Tae Woong Park","Kiyoul Kim","Abdulelah Ali","Oloruntomi Joledo","Sayli Bhide","Won Il Jung"]]
,["Pamela McCauley",["Mubarak Banisakher","Tiffaney Alexander","Aaron Yeaton","Kristine Margaret Relvini","Robert A. Claflin","Christopher Reid","Tareq Ahram","Rochelle Jones","Deborah Sater Carstens","John A. Picciuto","Rhonda L. Freeman","Maged K. Malek","Wanda Greaves-Holmes","Chandre Butler","Joylene Ware","Jeffrey L. Cornett","Shannon Wooden","Susan Gaines","Sami Durrani"]]
,["Mansooreh Mollaghasemi",["Martin J. Steele","Ghaith Adnan Rabadi","Major Michael J. Johnson","Niloofar Yousefi","Henrik E. Hedlund","Lobna Okashah Rubin","Mahdi Nasereddin","Mohamed Fayez","James Barnard","Grant Cates"]]
,["Deborah Nightingale"]
,["Thomas O'Neal"]
,["Michael Proctor",["Robert Sottilare","Luis Vazquez","Matthew Davis","Richard J. Calloway","Teresita Sotomayor","Maria Bauer","Richard Davenport","Brian Mitchell Guise","Jeremy Thomas Lanman","Joshua Lewis","Benito Graniela","Victor Boyer","Michael Woodman","Lillian Campbell-Wynn","Robert Leroy Wittman","Wesley A. Milks","Nabil Rami","Gregory Douglass Schow"]]
,["Luis Rabelo",["Serge Sala-Diakanda","Mengmeng Chen","Sayli Bhide","Edwin Cortes","John Pastrana","Hamed Almalki","Mario Marin","Phillip T. Meade","Jeffrey Dawson","Khaled Alshareef","Hatim Bukhari","Ahmad D. Rahal","Ahmed Elattar","Khalid Nagadi","Wilawan Onkham","Alfonso Sarmiento","Mohammed Basingab","Jose Cintron","Karla Moore","Magdy Helal","Oloruntomi Joledo","Khaled Odeh","Cesar Munoz","Stuart Laval"]]
,["Charles Reilly",["Lindon P. Fairweather","Craig L. Tidwel","Nabin Sapkota","John O. Miller","Raymond R. Hill","Fernando Mata","David J. A. Gonsalvez"]]
,["Gavriel Salvendy"]
,["Ben D. Sawyer"]
,["Steve Scheinert"]
,["Randall Shumaker"]
,["Adan E. Vela",["Shahab Boumi",   "Seyyedyousef Oleyaeimotlagh"]]
,["Qipeng Phil Zheng",["Yuping Huang","Yiduo Zhan","Zhouchun Huang","Ramazan Unlu","Alaleh Razmjoo"]]
];

// transform the data into a useful representation
// 1 is inner, 2, is outer

// need: inner, outer, links
//
// inner: 
// links: { inner: outer: }


var outer = d3.map();
var inner = [];
var links = [];

var outerId = [0];

data.forEach(function(d){
	
	if (d == null)
		return;
	
	i = { id: 'i' + inner.length, name: d[0], related_links: [] };
	i.related_nodes = [i.id];
	inner.push(i);
	
	if (!Array.isArray(d[1]))
		d[1] = [d[1]];
	
	d[1].forEach(function(d1){
		
		o = outer.get(d1);
		
		if (o == null)
		{
			o = { name: d1,	id: 'o' + outerId[0], related_links: [] };
			o.related_nodes = [o.id];
			outerId[0] = outerId[0] + 1;	
			
			outer.set(d1, o);
		}
		
		// create the links
		l = { id: 'l-' + i.id + '-' + o.id, inner: i, outer: o }
		links.push(l);
		
		// and the relationships
		i.related_nodes.push(o.id);
		i.related_links.push(l.id);
		o.related_nodes.push(i.id);
		o.related_links.push(l.id);
	});
});

data = {
	inner: inner,
	outer: outer.values(),
	links: links
}

// sort the data -- TODO: have multiple sort options
outer = data.outer;
data.outer = Array(outer.length);


var i1 = 0;
var i2 = outer.length - 1;

for (var i = 0; i < data.outer.length; ++i)
{
	if (i % 2 == 1)
		data.outer[i2--] = outer[i];
	else
		data.outer[i1++] = outer[i];
}

console.log(data.outer.reduce(function(a,b) { return a + b.related_links.length; }, 0) / data.outer.length);


// from d3 colorbrewer: 
// This product includes color specifications and designs developed by Cynthia Brewer (http://colorbrewer.org/).
var colors = ["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]
var color = d3.scale.linear()
    .domain([60, 220])
    .range([colors.length-1, 0])
    .clamp(true);

var diameter = 960;
var rect_width = 120;
var rect_height = 24;

var link_width = "1px"; 

var il = data.inner.length;
var ol = data.outer.length;

var inner_y = d3.scale.linear()
    .domain([0, il])
    .range([-(il * rect_height)/2, (il * rect_height)/2]);

mid = (data.outer.length/2.0)
var outer_x = d3.scale.linear()
    .domain([0, mid, mid, data.outer.length])
    .range([15, 170, 190 ,355]);

var outer_y = d3.scale.linear()
    .domain([0, data.outer.length])
    .range([0, diameter / 2 - 120]);


// setup positioning
data.outer = data.outer.map(function(d, i) { 
    d.x = outer_x(i);
    d.y = diameter/3;
    return d;
});

data.inner = data.inner.map(function(d, i) { 
    d.x = -(rect_width / 2);
    d.y = inner_y(i);
    return d;
});


function get_color(name)
{
    var c = Math.round(color(name));
    if (isNaN(c))
        return '#dddddd';	// fallback color
    
    return colors[c];
}

// Can't just use d3.svg.diagonal because one edge is in normal space, the
// other edge is in radial space. Since we can't just ask d3 to do projection
// of a single point, do it ourselves the same way d3 would do it.  


function projectX(x)
{
    return ((x - 90) / 180 * Math.PI) - (Math.PI/2);
}

var diagonal = d3.svg.diagonal()
    .source(function(d) { return {"x": d.outer.y * Math.cos(projectX(d.outer.x)), 
                                  "y": -d.outer.y * Math.sin(projectX(d.outer.x))}; })            
    .target(function(d) { return {"x": d.inner.y + rect_height/2,
                                  "y": d.outer.x > 180 ? d.inner.x : d.inner.x + rect_width}; })
    .projection(function(d) { return [d.y, d.x]; });


var svg = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
  .append("g")
    .attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");
    

// links
var link = svg.append('g').attr('class', 'links').selectAll(".link")
    .data(data.links)
  .enter().append('path')
    .attr('class', 'link')
    .attr('id', function(d) { return d.id })
    .attr("d", diagonal)
    .attr('stroke', function(d) { return get_color(d.inner.name); })
    .attr('stroke-width', link_width);

// outer nodes

var onode = svg.append('g').selectAll(".outer_node")
    .data(data.outer)
  .enter().append("g")
    .attr("class", "outer_node")
    .attr("transform", function(d) { return "rotate(" + (d.x - 90) + ")translate(" + d.y + ")"; })
    .on("mouseover", mouseover)
    .on("mouseout", mouseout).on('click',mouseoclick);
  
onode.append("circle")
    .attr('id', function(d) { return d.id })
    .attr("r", 4.5);
  
onode.append("circle")
    .attr('r', 20)
    .attr('visibility', 'hidden');
  
onode.append("text")
	.attr('id', function(d) { return d.id + '-txt'; })
    .attr("dy", ".31em")
    .attr("text-anchor", function(d) { return d.x < 180 ? "start" : "end"; })
    .attr("transform", function(d) { return d.x < 180 ? "translate(8)" : "rotate(180)translate(-8)"; })
    .text(function(d) { return d.name; });
for( var j = 0; j<data.outer.length;j++){
d3.select("#"+data.outer[j].id+"-txt").style("opacity", 0);
}
  
// inner nodes
  
var inode = svg.append('g').selectAll(".inner_node")
    .data(data.inner)
  .enter().append("g")
    .attr("class", "inner_node")
    .attr("transform", function(d, i) { return "translate(" + d.x + "," + d.y + ")"})
    .on("mouseover", mouseover)
    .on("mouseout", mouseout).on('click',mouseClick);
  
inode.append('rect')
    .attr('width', rect_width)
    .attr('height', rect_height)
    .attr('id', function(d) { return d.id; })
    .attr('fill', function(d) { return get_color(d.name); });
  
inode.append("text")
	.attr('id', function(d) { return d.id + '-txt'; })
    .attr('text-anchor', 'middle')
    .attr("transform", "translate(" + rect_width/2 + ", " + rect_height * .75 + ")")
    .text(function(d) { return d.name; });

// need to specify x/y/etc

d3.select(self.frameElement).style("height", diameter - 150 + "px");

function mouseover(d)
{
	// bring to front
	d3.selectAll('.links .link').sort(function(a, b){ return d.related_links.indexOf(a.id); });	
	
    for (var i = 0; i < d.related_nodes.length; i++)
    {
        d3.select('#' + d.related_nodes[i]).classed('highlight', true);
        d3.select('#' + d.related_nodes[i] + '-txt').attr("font-weight", 'bold');
    }
    
    for (var i = 0; i < d.related_links.length; i++)
        d3.select('#' + d.related_links[i]).attr('stroke-width', '5px');
}
function mouseoclick(d)
{
    alert(d.name);
    var width = 960,
    height = 500;
 
var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    
d3.json("data.json", function(json) {
    /* Define the data for the circles */
    var elem = svg.selectAll("g myCircleText")
        .data(json.nodes)
  
    /*Create and place the "blocks" containing the circle and the text */  
    var elemEnter = elem.enter()
        .append("g")
        .attr("transform", function(d){return "translate("+d.x+",80)"})
 
    /*Create the circle for each block */
    var circle = elemEnter.append("circle")
        .attr("r", function(d){return d.r} )
        .attr("stroke","black")
        .attr("fill", "white")
 
    /* Create the text for each block */
    elemEnter.append("text")
        .attr("dx", function(d){return -20})
        .text(function(d){return d.label})
})
    var name=d.name;
    d3.select("body").selectAll(".inner_node").remove();
    d3.select("body").selectAll(".outer_node").remove();
    var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");
    //var svg=document.body.innerHTML='';
    var node = svg.append("g")
        .attr("class", "nodes")
        .selectAll("circle").attr("transform","translate(500,500)")
        .data(name)
        .enter()
        .append("circle")
        .attr("r", 100)
        .attr("fill", "blue").attr("text",name);  

    node.append("text").text(function(d){console.log("inside here"); console.log(name);return d.name});


//draw lines for the links 
var link = svg.append("g")
      .attr("class", "links")
    .selectAll("line")
    .data(d.name)
    .enter().append("line")
      .attr("stroke-width", 2)
      .style("stroke", "green");

    //var svg=document.body.innerHTML='';
    /*d3.select("body").selectAll(".inner_node").remove();
    d3.select("body").selectAll(".outer_node").remove();
    var a=d3.select("body").selectAll(".advicee").data(data.outer).enter().append("g").attr("class","advicee");
    a.append('circle').attr('r',55);

    /*var svg2 = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
  .append("g")
    .attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");
    

    
// outer nodes
var advicee = svg.append('g').selectAll(".advicee")
    .data(data.outer)
  .enter().append("g")
    .attr("class", "outer_node")
    .attr("transform", function(d) { return "rotate(" + (d.x - 90) + ")translate(" + (d.y-200) + ")"; });
   
  
advicee.append("circle")
    .attr('id', function(d) { return d.id })
    .attr("r", 4.5);
  
advicee.append("circle")
    .attr('r', 40); 
  
//advicee.append("text")
//  .attr('id', function(d) { return d.id + '-txt'; })
  //  .attr("dy", ".31em")
    //.attr("text-anchor", function(d) { return d.x < 180 ? "start" : "end"; })
    //.attr("transform", function(d) { return d.x < 180 ? "translate(8)" : "rotate(180)translate(-8)"; })
    //.text(function(d) { return d.name; });
    
//for( var j = 0; j<data.outer.length;j++){
//d3.select("#"+data.outer[j].id+"-txt").style("opacity", 0);
//}
    console.log("reached here too");
    /*var advicee = d.name;
    var advicedisplay=svg.append('g').selectAll(".inner_node").data(data.inner).enter().append("g").attr("class","click").attr("transform",function(d,i){return "rotate(" + (d.x - 0) + ")translate(" + (d.y-100) + ")"});
    advicedisplay.append("circle").attr('r',40);
    */
}

function mouseout(d)
{   	
    for (var i = 0; i < d.related_nodes.length; i++)
    {
        d3.select('#' + d.related_nodes[i]).classed('highlight', false);
        d3.select('#' + d.related_nodes[i] + '-txt').attr("font-weight", 'normal');
    }
    
    for (var i = 0; i < d.related_links.length; i++)
        d3.select('#' + d.related_links[i]).attr('stroke-width', link_width);
}
function mouseClick(d) 
{
    console.log(data.outer);
    console.log("outer data ------- ",data.outer[98].id);
    for( var j = 0; j<data.outer.length;j++){
        d3.select("#"+data.outer[j].id+"-txt").style("opacity", 0);
    }
    for (var i = 0; i < d.related_nodes.length; i++)
    {
        for( var j = 0; j<data.outer.length;j++){
          if(d.related_nodes[i] == data.outer[j].id)
          {
          console.log("found" +data.outer[j].id);
          for(x=0;x<data.outer[j].length;x++)
          {
            var list= list + data.outer[x].get(name);
          }
          console.log(list);
          
          d3.select("#"+data.outer[j].id+"-txt").style("opacity", 1);
          }
      //  console.log("mouseClick",d.name );
        console.log("new",d.related_nodes[i]);
        }
    }
}

</script>
